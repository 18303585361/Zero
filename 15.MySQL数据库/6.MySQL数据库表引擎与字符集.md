# Mysql数据库表引擎与字符集

### 1.服务器处理客户端请求

其实不论客户端进程和服务器进程是采用哪种方式进行通信，最后实现的效果都是：客户端进程向服务器进程发送一段文本（MySQL语句），服务器进程处理后再向客户端进程发送一段文本（处理结果）。那服务器进程对客户端进程发送的请求做了什么处理，才能产生最后的处理结果呢？客户端可以向服务器发送增删改查各类请求。

+ 流程：客户端进程向服务器发送请求，服务器

> ①处理连接
>
> ②对发送的请求语句进行语法解析
>
> ③解析完成后进行查询优化
>
> ④将解析后的请求提交给存储引擎
>
> ⑤存储引擎按照要求在文件系统中找到并返回

### 2. 存储引擎

Mysql服务器把数据的存储和提取操作都封装到了一个叫存储引擎的模块中。我们知道 表 是由一行一行的记录组成的，但这只是一个逻辑上的概念。物理上如何表示记录，怎么从表中读取数据，怎么把数据写入具体的物理存储器上，这都是存储引擎负责的事情。为了实现不同的功能，Mysql提供了各式各样的引擎，不同存储引擎管理的表的具体存储结构不同，采用的存储算法也不同。

> 存储引擎以前叫表处理器，它的功能就是接收上层传下来的指令，然后对表中的数据进行提取或写入操作

为了管理方便，人们把连接管理、查询缓存、语法解析、查询优化这些并不涉及真实数据存储的功能划分为Mysql server的功能，把真实存储数据的功能划分为 存储引擎 的功能。各种不同的存储引擎向上边的Mysql Server 层提供统一的调用接口（也就是存储引擎API），包含了几十个底层函数，像“读取索引第一条内容“，”读取索引下一条内容“，”插入记录“等等。

所以在Mysql server 完成了查询优化后，只需按照生成的执行计划调用底层存储引擎提供的API，获取到数据后返回给客户端就好了。

+ Mysql支持的存储引擎列表：

> archive	用于数据存档（行被插入后不能再修改）
>
> blackhole	丢弃写操作，读操作会返回空内容
>
> csv	在存储数据时，以逗号分隔各个数据项
>
> federated	用来访问远程表
>
> **innodb（常用）**	具备外键支持功能的事务存储引擎
>
> **memory**	置于内存的表
>
> merge	用来管理多个MylSAM表构成的表集合
>
> **MyISAM（常用）**	主要的非事务处理存储引擎
>
> ndb	MySQL集群专用存储引擎

### 3.MyISAM和InnoDB表引擎的区别

#### 1）事务支持

MyISAM不支持事务，而InnoDB支持。

>事务是指访问并更新数据库中数据的执行单元。
>
>事务操作中，要么执行要么不执行

#### 2）存储结构

MyISAM：每个MyISAM在磁盘上存储成三个文件

+ .frm 存储表结构
+ .MYD 存储数据
+ .MYI 存储索引

InnoDB：主要分为两种文件进行存储

+ .frm 存储表结构

+ .ibd 存储数据和索引（也可能是多个 ibd 文件或者是独立的表空间文件）

#### 3）表锁差异

**MyISAM：只支持表级锁。**用户在操作myisam表时，select、update、delete、insert语句都会给表自动加锁。如果加锁后的表满足 insert 并发的情况下，可以在表的尾部插入新的数据。

**InnoDB：支持事务和行级锁，是innodb的最大特色。**行锁大幅度提高了多用户并发操作。但是innodb的行锁，只是在where的主键是有效的，非主键的where都会锁全表。

#### 4）表主键

MyISAM：允许没有任何索引和主键的表存在，索引都是保存行的地址。

InnoDB：如果没有设定主键或者非空唯一索引，就会自动生成一个6字节的主键（用户不可见），数据是主索引的一部分，附加索引保存的是主索引的值。InnoDB的主键范围更大，最大是MyISAM的2倍。

#### 5）表的具体行数

MyISAM：保存有表的总行数，如果 `select count（） from table 表名；`会直接提取出该表值。

InnoDB：没有保存表的总行数（只能遍历），如果使用`select count（） from table 表名；`就会遍历整个表，消耗相当大。但是在加了where条件后，这两种引擎的处理方式一样。

#### 6）CURD操作

MyISAM：如果执行大量 select，MyISAM是更好的选择

InnoDB：如果你的数据执行大量的insert或update，出于性能考虑，应该使用innodb表。delete 从性能上innodb更优，但delete from table时，innodb不会重新建立表，而是一行一行的删除。在innodb上如果要清空保存有大量数据的表，最好使用truncate table这个命令

#### 7）外键

MyISAM:不支持

InnoDB：支持

#### 8）查询效率

MyISAM：相对简单，效率上优于innoDB，小型应用可以考虑使用。

推荐考虑使用Innodb来替代，是因为InnoDB自身有很多良好特点，比如事务支持，存储过程、视图、行级锁定等等，在并发很多的情况下，InnoDB比MyISAM强。

另外，任何一种表都不是万能的，只用恰当的针对业务类型来选择合适的表类型，才能最大的发挥MySQL的性能优势。

#### 9）MyISAM和InnoDB两者的应用场景：

MyISAM管理非事务表。它提供高速存储和检索，以及全文搜索能力。如果应用中需要执行大量的 select 查询，那么MyISAM是最好的选择。

InnoDB用于事务处理应用程序，具有众多特性，包括ACID事务支持。如果应用中需要执行大量的insert 或 update 操作，则应该使用InnoDB。

### 4.了解一下字符集和乱码

#### 字符集简介

我们知道计算机只能存储二进制数据，那该怎么存储字符串呢？当然时建立字符与二进制数据的映射关系了，建立这种关系最起码要搞清楚两件事：

1.你要把哪些字符映射成二进制数据？

​	也就是界定清楚自负范围。

2.怎么映射？

​	将一个字符映射成一个二进制数据的过程叫做编码。将一个二进制数据映射成一个字符的过程叫做解码。人们抽象出一个字符集的概念来描述某个自负范围的编码规则。

3.常用字符集

+ ASCII字符集

共收录了128个字符，包括空格、标点符号、数字、大小写字母和一些不可见字符。它使用 1 个字节来编码，如：

```mysql
'L' ==> 01001100(十六进制：Ox4C,十进制：76)
'M' ==> 01001101(十六进制：Ox4D,十进制：77)
```

+ ISO 8859-1字符集

共收录256个字符，实在ASCII字符集的基础上又扩充了128个西欧常用字符（包括德法两国字母），也可以使用 1 个字节来进行编码。

+ GB2312 字符集

  收录了汉字以及拉丁字母、希腊字母、日文平假名、片假名字母、俄语西里尔字母。共收录汉字6763个，其它文字符号682个。同时这种字符集又兼容 ASCII字符集，在编码方式上有些奇怪：

  + 如果该字符在 ASCII字符集中，则采用 1 字节编码
  + 否则采用 2 字节编码

这种表示一个字符需要不同字节数的编码方式称为变长编码方式。比方式字符串'爱u'，其中'爱'需要用2个字节进行编码，编码后的十六进制表示为OxCED2，'u'需要用 1个字节进行编码，编码后的十六进制表示为 Ox75，所以拼合起来就是 OxCED275。

>小贴士：我们怎么区分某个字节代表一个单独的字符还是代表某个字符的一部分呢？别忘了 ASCII字符集只收录128个字符，使用 0~127就可以表示全部字符，如果某个字符在0~127之内，就意味着一个字节代表一个单独的字符，否则就是两个字节代表一个单独的字符。

+ GBK 字符集

  GBK字符集只是在收录范围上对 GB2312 字符集进行了扩充，编码方式上兼容 GB2312。

+ utf8字符集

收录地球上能想到的所有字符，而且不断扩充。这种字符集兼容ASCII字符集，采用变长编码方式，编码一个字符需要使用1~4个字节。

### 5.MySQL中的utf8和utf8mb4

utf8mb3：阉割过的utf8字符集，只使用1~3个字节表示字符

utf8mb4：正宗的utf8字符集，使用1~4字节来表示字符

在MySQL中，utf8是utf8mb3的别称。

#### 字符集的查看

使用`show character set`或者 `show charset;` 查看MySQL中支持的字符集。

